var inlineEditClass=function(a,e,t){var r={params:{tableId:a.tableId,currentCell:"",editInputId:"dt_cell_edit",editSelector:"#dt_cell_edit",validationPopover:'<div class="wpDataTablesPopover editError"></div>',value:"",table:"",cellData:"",cellInfo:"",rowId:"",columnId:"",columnType:"",inputType:"",columnHeader:"",notNull:"",code:"",expandButton:"",valid:!0,additionalValid:!0,dateFormat:a.datepickFormat.replace(/y/g,"yy").replace(/Y/g,"yyyy").replace(/M/g,"mmm")},removeSelection:function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}},setErrorPopoverPosition:function(a,e){var t="",r=a.offset(),l=a.outerWidth(!0),s=(a.outerHeight(!0),r.left+l/2-e.width/2),i=r.top-e.height;return t={top:i,left:s}},parseLink:function(){if(-1!=r.params.value.indexOf("<a ")&&-1!==t.inArray(r.params.columnType,["link","email"])){var a=t(r.params.value);-1===a.attr("href").indexOf(a.html())?r.params.value=a.attr("href").replace("mailto:","")+"||"+a.html():r.params.value=a}},saveData:function(e,l,s){t(a.selector).addClass("overlayed"),wpDataTables[r.params.tableId].fnUpdate(e,l,s,0,0);var i=wpDataTables[r.params.tableId].fnGetData(l);wpDataTablesFunctions[r.params.tableId].applyData(i),wpDataTablesFunctions[r.params.tableId].saveTableData(1),t(a.selector).find("td").removeClass("editing")},fieldValidation:function(a,e){if(""!=r.params.value){if("email"==a)var l=wdtValidateEmail(r.params.value),s=wpdatatables_frontend_strings.invalid_email;else if("link"==a)var l=wdtValidateURL(r.params.value),s=wpdatatables_frontend_strings.invalid_link;if(l)t(this).closest("td").removeClass("error"),r.params.valid=!0,r.params.additionalValid=!0;else{if(!e.closest("td").hasClass("error")){e.closest("td").addClass("error"),t("body").prepend(r.params.validationPopover),t(".wpDataTablesPopover.editError").html(s);var i={width:t(".wpDataTablesPopover.editError").outerWidth(),height:t(".wpDataTablesPopover.editError").outerHeight()+7};t(".wpDataTablesPopover.editError").css(r.setErrorPopoverPosition(e,i)),setTimeout(function(){t(".wpDataTablesPopover.editError").fadeOut("300",function(){t(this).remove(),e.closest("td").removeClass("error")})},2e3)}r.params.valid=!1,r.params.additionalValid=!1}}else r.params.valid=!0,r.params.additionalValid=!0},mandatoryFieldValidation:function(a){if(""!=a.val()&&r.params.additionalValid)a.closest("td").removeClass("error"),r.params.valid=!0;else if(!a.closest("td").hasClass("error")){a.closest("td").addClass("error"),t("body").prepend(r.params.validationPopover),t(".wpDataTablesPopover.editError").html(wpdatatables_frontend_strings.cannot_be_empty);var e={width:t(".wpDataTablesPopover.editError").outerWidth(),height:t(".wpDataTablesPopover.editError").outerHeight()+7};t(".wpDataTablesPopover.editError").css(r.setErrorPopoverPosition(a,e)),setTimeout(function(){t(".wpDataTablesPopover.editError").fadeOut("300",function(){t(this).remove(),a.closest("td").removeClass("error")})},2e3),r.params.valid=!1}},validateAndSave:function(e){var l=new Array("email","link");-1!==t.inArray(r.params.inputType,l)?(r.fieldValidation(r.params.inputType,e),r.params.notNull&&r.mandatoryFieldValidation(e)):r.params.notNull&&r.mandatoryFieldValidation(e),r.params.valid&&("date"==r.params.inputType?datePickerInit(a.selector+" .row_edit_datepicker",additional_params,"opened"):t.when(r.saveData(r.params.value,r.params.rowId,r.params.columnId)).then(r.params.currentCell.prepend(r.params.expandButton)))},FieldTypeMethods:{noneditableCell:function(){r.params.currentCell.removeClass("editing");var a=r.params.currentCell,e=r.params.currentCell.html();r.params.currentCell.empty().html("You can't edit this field"),t(document).click(function(){a.html(e)})},textCell:function(){r.parseLink(),r.params.code='<input type="text" data-input_type="'+r.params.inputType+'" id="'+r.params.editInputId+"\" value='"+r.params.value+"' />",r.params.currentCell.empty().append(r.params.code),t(r.params.editSelector).focus(),t(r.params.editSelector).blur(function(){r.params.value=t(this).val(),r.validateAndSave(t(this))})},textareaCell:function(){r.parseLink(),-1!=r.params.value.indexOf("<br/>")&&(r.params.value=r.params.value.replace(/<br\/>/g,"\n")),r.params.code='<textarea data-input_type="'+r.params.inputType+'" id="'+r.params.editInputId+'" rows="3" columns="50">'+r.params.value+"</textarea>",r.params.currentCell.empty().append(r.params.code),t(r.params.editSelector).focus(),t(r.params.editSelector).blur(function(){r.params.value=t(this).val(),r.validateAndSave(t(this))})},tinymceCell:function(){r.parseLink(),-1!=r.params.value.indexOf("<br/>")&&(r.params.value=r.params.value.replace(/<br\/>/g,"\n")),r.params.code='<textarea class="wpdt-tiny-mce" data-input_type="'+r.params.inputType+'" id="'+r.params.editInputId+'" rows="3" columns="50">'+r.params.value+"</textarea>",r.params.currentCell.empty().append(r.params.code),tinymce.init({selector:r.params.editSelector,auto_focus:r.params.editInputId,menubar:!1,init_instance_callback:function(a){a.on("blur",function(a){tinymce.triggerSave(),r.params.value=t(r.params.editSelector).val(),r.validateAndSave(t(r.params.editSelector))})}})},linkCell:function(){r.parseLink(),r.params.code='<input type="text" data-input_type="'+r.params.inputType+'" id="'+r.params.editInputId+'" value="'+r.params.value+'" />',r.params.currentCell.empty().append(r.params.code),t(r.params.editSelector).focus(),t(r.params.editSelector).blur(function(){r.params.value=t(this).val(),r.validateAndSave(t(this))})},dateCell:function(){r.params.code='<input type="text" class="row_edit_datepicker" data-input_type="'+r.params.inputType+'" id="'+r.params.editInputId+'" value="'+r.params.value+'" />',r.params.currentCell.empty().append(r.params.code);var e=function(){r.params.value=t(r.params.editSelector).val(),t.when(r.saveData(r.params.value,r.params.rowId,r.params.columnId)).then(t(r.params.editSelector).prepend(r.params.expandButton))};r.params.valid&&r.datePickerInit(a.selector+" .row_edit_datepicker",e,"opened")},selectboxCell:function(){if(r.params.code=t("#"+a.tableId+"_"+r.params.columnHeader).clone(),r.params.currentCell.empty().append(r.params.code.attr("id",r.params.editInputId).removeClass("selecter-element")),null!==r.params.value&&t.each(r.params.value.split(", "),function(a,e){t(r.params.editSelector+' option[value="'+e+'"]').prop("selected",!0)}),t(r.params.editSelector).selecter().focus(),"selectbox"==r.params.inputType){r.params.currentCell.css({overflow:"initial"});var e=!1;t(r.params.editSelector).change(function(){e=!0,r.params.value=t(this).val(),"array"===t.type(r.params.value)&&(r.params.value=r.params.value.join(", ")),r.validateAndSave(t(this))}),t(r.params.editSelector).closest(".selecter").blur(function(){e||(r.params.value=t("#"+r.params.editInputId).val(),"array"===t.type(r.params.value)&&(r.params.value=r.params.value.join(", ")),r.validateAndSave(t(this)))})}else t(r.params.editSelector).closest(".selecter").blur(function(){r.params.value=t("#"+r.params.editInputId).val(),"array"===t.type(r.params.value)&&(r.params.value=r.params.value.join(", ")),r.validateAndSave(t(this))})},attachmentCell:function(){r.params.value="";var e="",l="";r.params.currentCell.find("img").length>0?r.params.currentCell.find("img").attr("src").length>0&&(e=r.params.currentCell.find("img").attr("src")):r.params.currentCell.find("a").length>0?r.params.currentCell.find("a").attr("href").length>0&&(e=r.params.currentCell.find("a").attr("href")):e=r.params.currentCell.html();var s=e.substring(e.lastIndexOf("/")+1);l="<p>"+s+' [<a href="#" data-key="row_edit_'+a.tableId+'_sets" class="wdtdeleteFile">'+wpdatatables_frontend_strings.detach_file+"</a>]</p>",r.params.code='<span class="fileinput-button">\n				   <button id="row_edit_'+a.tableId+'_sets_button" data-column_type="icon" data-rel_input="row_edit_'+a.tableId+'_sets" class="btn fileupload_row_edit_'+a.tableId+'">'+wpdatatables_frontend_strings.browse_file+'</button>\n				   <input type="hidden" id="row_edit_'+a.tableId+'_sets" data-key="sets" data-input_type="attachment" class="editDialogInput" value="'+e+'" />\n				   <button class="btn row_edit_fileupload_submit_'+a.tableId+'">'+wpdatatables_frontend_strings.ok+'</button>\n			       </span>\n			       <div id="files_row_edit_'+a.tableId+'_sets" class="files">'+l+"</div>",r.params.currentCell.empty().append(r.params.code),r.fileUploadInit("row_edit_"+a.tableId),t(".row_edit_fileupload_submit_"+a.tableId).click(function(){r.params.value=t("#row_edit_"+a.tableId+"_sets").val(),r.params.value='<a href="'+r.params.value+'"></a>',t("#row_edit_"+a.tableId+"_sets").closest("td").empty().html(r.params.value),r.validateAndSave(t(this))})}},fileUploadInit:function(a){t(".fileupload_"+a).length&&(wdtCustomUploader=wp.media({title:wpdatatables_frontend_strings.select_upload_file,button:{text:wpdatatables_frontend_strings.choose_file},multiple:!1}),t("button.fileupload_"+a).click(function(a){a.preventDefault();var e=t(this),l=t("#"+e.data("rel_input"));"icon"==r.params.columnType?(wdtCustomUploader=wp.media({title:wpdatatables_frontend_strings.select_upload_file,button:{text:wpdatatables_frontend_strings.choose_file},multiple:!1,library:{type:"image"}}),wdtCustomUploader.off("select").on("select",function(){attachment=wdtCustomUploader.state().get("selection").first().toJSON(),l.val(attachment.sizes.thumbnail.url+"||"+attachment.url),t("#files_"+e.data("rel_input")).html("<p>"+attachment.filename+' [<a href="#" data-key="'+e.data("rel_input")+'" class="wdtdeleteFile">'+wpdatatables_frontend_strings.detach_file+"</a>]</p>")})):wdtCustomUploader.off("select").on("select",function(){attachment=wdtCustomUploader.state().get("selection").first().toJSON(),l.val(attachment.url),t("#files_"+e.data("rel_input")).html("<p>"+attachment.filename+' [<a href="#" data-key="'+e.data("rel_input")+'" class="wdtdeleteFile">'+wpdatatables_frontend_strings.detach_file+"</a>]</p>")}),wdtCustomUploader.open()}))},datePickerInit:function(a,e,l){var s=t(a).pickadate({format:r.params.dateFormat,formatSubmit:r.params.dateFormat,selectYears:20,selectMonths:!0,container:".wpDataTablesWrapper",onClose:e}),i=s.pickadate("picker");"opened"==l&&i.open()},bindClickEvent:function(){t(a.selector).on("dblclick","td",function(l){var s=l.target||l.srcElement,i=s.tagName.toLowerCase();if("input"==i||!r.params.valid||t(this).hasClass("editing"))return!1;switch(r.removeSelection(),t(this).addClass("editing"),r.params.table=t(a.selector).DataTable(),r.params.cellData=r.params.table.cell(this).data(),r.params.cellInfo=r.params.table.cell(this).index(),r.params.columnId=r.params.cellInfo.column,r.params.columnType=wpDataTables[r.params.tableId].fnSettings().aoColumns[r.params.columnId].wdtType,r.params.rowId=r.params.cellInfo.row,r.params.inputType=e.aoColumnDefs[r.params.columnId].InputType,r.params.columnHeader=e.aoColumnDefs[r.params.columnId].origHeader,r.params.notNull=e.aoColumnDefs[r.params.columnId].notNull,r.params.value=r.params.cellData,r.params.currentCell=t(this),""!=t(this).children(".responsiveExpander")&&(r.params.expandButton=t(this).children(".responsiveExpander")),r.params.inputType){case"none":r.FieldTypeMethods.noneditableCell();break;case"text":r.FieldTypeMethods.textCell();break;case"textarea":r.FieldTypeMethods.textareaCell();break;case"mce-editor":r.FieldTypeMethods.tinymceCell();break;case"link":case"email":r.FieldTypeMethods.linkCell();break;case"date":r.FieldTypeMethods.dateCell();break;case"multi-selectbox":case"selectbox":r.FieldTypeMethods.selectboxCell();break;case"attachment":r.FieldTypeMethods.attachmentCell()}})}};r.bindClickEvent()};
